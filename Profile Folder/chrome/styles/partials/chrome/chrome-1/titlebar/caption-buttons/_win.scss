&[gktitbuttons="windows"] {
	//Show the Google logo before the buttons
	&[gkbranding="chrome"]:not([geckium-chrflag-glen-is-close-button="true"])  {
		.titlebar-buttonbox-container {
			&::before {
				content: url("chrome://userchrome/content/assets/img/chrome-1/titlebar/windows/google.png");
				margin-block-start: 2px;
				margin-inline-end: 7px;
			}
		}
		&[sizemode="maximized"],
		&[sizemode="fullscreen"] {
			.titlebar-buttonbox-container {
				&::before {
					content: unset !important;
				}
			}
		}
	}

	&[gktitnative="false"] {
		//Use the white Google logo in non-native titlebars
		//TODO: Show on other platforms, too, behind its flag
		&[gkbranding="chrome"]:not([geckium-chrflag-glen-is-close-button="true"]) {
			.titlebar-buttonbox-container::before {
				content: url("chrome://userchrome/content/assets/img/chrome-1/titlebar/windows/google-alternate.png");
				margin-block-start: 3px;
			}
		}

		//Shared non-native titlebar variables
		& {
			--titlebutton-border-outer: 1px solid rgb(0, 0, 0, 0.35);
			--titlebutton-corner: 5px;
			--titlebutton-background-hover: rgba(255, 255, 255, 0.3);
			--titlebutton-background-active: rgba(255, 255, 255, 0.2);
		}

		//Titlebar button box (force onto right side)
		.titlebar-buttonbox-container {
			order: 1000 !important;
			margin-inline-end: calc(var(--titlebar-border-radius) - 1px); // right margin
		}
		//macOS quirk: Counteract exclusive menubar padding
		@media (-moz-platform: linux) {
			#toolbar-menubar .titlebar-buttonbox-container {
				margin-block-start: -1px; // top margin
			}
		}
		//Linux quirk: Counteract exclusive menubar padding
		@media (-moz-platform: linux) {
			#toolbar-menubar .titlebar-buttonbox-container {
				margin-block-start: -1px; // top margin
			}
		}
		// TODO: Check right-to-left mode

		.titlebar-buttonbox {
			appearance: none !important;
			align-items: unset !important;
			box-shadow: 1px 1px 0px 0px rgba(255, 255, 255, 0.2);
			border-bottom-left-radius: var(--titlebutton-corner); //the box-shadow extrudes, thus automatically deducts 1px
			border-bottom-right-radius: var(--titlebutton-corner);
			// FIXME: Better way to make the buttonbox decide to be the correct height thus not offset the shadow underneath
			height: 17px;
		}

		//Shared titlebar button code
		.titlebar-button {
			appearance: none !important; //Firefox AGAIN having self-bias, so we need !important
			background: transparent;
			border-radius: 0 !important;
			border-left: var(--titlebutton-border-outer) !important;
			border-bottom: var(--titlebutton-border-outer) !important;
			height: 17px;
			background-clip: padding-box !important;
			box-shadow: inset 1px 1px 0px 0px rgba(255, 255, 255, 0.3);
			position: relative; // Required for pseudo button-backgrounds
			transition: background-color 100ms linear; //hover-fade animation
			width: 25px;
			display: flex !important; // Really, macOS's Mozilla Firefox?
			padding: 0 !important;
			margin: 0 !important;
			margin-inline-end: 0 !important;

			// Pseudo titlebar button background
			&:before {
				content: "";
				position: absolute;
				left: 0;
				top: 0;
				width: 100%;
				height: 100%;
				background: var(--titlebar-buttonbox-background);
				z-index: -1;
			}

			.toolbarbutton-icon {
				height: auto !important;
				width: auto !important;

				// Fix for Firefox ~120+
				appearance: none;
				background: none;
				border-radius: unset;
			}
			image { // Set the icon's opacity and hover-fade
				opacity: .6 !important;
				transition: opacity 100ms linear;
			}

			//Hover and pressed states
			&:hover {
				background: rgba(255, 255, 255, 0.3);
				image {
					opacity: 1 !important;
				}
			}
			&:active {
				background: rgba(255, 255, 255, 0.2);
				&:not([disabled]) {
					transition: none;
				}
			}
		}
		.titlebar-max,
		.titlebar-restore,
		.titlebar-min {
			&:active {
				box-shadow: inset 1px 1px 0px 0px rgba(0, 0, 0, 0.2);
			}
		}

		//Close button
		.titlebar-close {
			width: 43px;
			list-style-image: url(chrome://userchrome/content/assets/img/chrome-1/titlebar/windows/close.svg) !important; // Mozilla bias moment #idk
			border-right: var(--titlebutton-border-outer) !important;
			border-bottom-right-radius: var(--titlebutton-corner) !important; // because border-radius is !important
			order: 2 !important;

			&:hover {
				background: rgb(217, 76, 74);
			}

			&:active {
				background: rgb(213, 58, 63);
			}
		}

		//Maximise and Restore buttons
		.titlebar-max {
			list-style-image: url(chrome://userchrome/content/assets/img/chrome-1/titlebar/windows/maximize.svg) !important;
		}
		&[sizemode="maximized"],
		&[sizemode="fullscreen"] {
			.titlebar-max {
				display: none !important;
			}
		}
		.titlebar-restore {
			list-style-image: url(chrome://userchrome/content/assets/img/chrome-1/titlebar/windows/restore.svg) !important;
			.toolbarbutton-icon {
				transform: translateX(-1px);
			}
		}
		&:not([sizemode="maximized"]):not([sizemode="fullscreen"]) {
			.titlebar-restore {
				display: none !important;
			}
		}
		.titlebar-max,
		.titlebar-restore {
			order: 1 !important;
		}

		//Minimise button
		.titlebar-min {
			list-style-image: url(chrome://userchrome/content/assets/img/chrome-1/titlebar/windows/minimize.svg) !important;
			border-bottom-left-radius: 5px !important; // because border-radius is !important
			order: 0 !important;
		}

		// Glen's head
		&[geckium-chrflag-glen-is-close-button="true"] {
			//Move where the shadow is for Glen's head
			.titlebar-buttonbox {
				box-shadow: unset;
			}
			.titlebar-max,
			.titlebar-restore,
			.titlebar-min {
				box-shadow: inset 1px 1px 0px 0px rgba(255, 255, 255, 0.3),
					1px 1px 0px 0px rgba(255, 255, 255, 0.2);
				&:active { //Add to the existing shadow
					box-shadow: inset 1px 1px 0px 0px rgba(0, 0, 0, 0.2),
						1px 1px 0px 0px rgba(255, 255, 255, 0.2);
				}
			}
			.titlebar-max,
			.titlebar-restore {
				clip-path: inset(-1px 0px -1px -1px); //Remove the right-side shadow
			}
			// Change close to Glen's head, and make further necessary adjustments
			.titlebar-close {
				width: 24px;
				height: 32px;
				background: url(chrome://userchrome/content/assets/img/chrome-1/titlebar/linux/glen-close.png) !important; // Mozilla bias moment #idk
				background-position: center !important;
				background-repeat: no-repeat !important;
				border-bottom: unset !important;
				border-left: unset !important;
				border-right: unset !important;
				border-bottom-right-radius: 0 !important; // because border-radius is !important
				box-shadow: unset;
				list-style-image: unset !important;
	
				&:hover, &:active {
					background: unset;
				}
				&:before {
					content: unset; // Glen cannot be themed.
				}
			}
			.titlebar-max,
			.titlebar-restore {
				border-right: var(--titlebutton-border-outer) !important;
			}
		}
	}
}