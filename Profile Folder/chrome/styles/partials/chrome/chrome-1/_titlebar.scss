:root {
	// Make Firefox's Windows 10 CSDs white to be faithful to Windows 10+'s titlebar
	--toolbox-non-lwt-bgcolor: light-dark(white, black);
	--toolbox-non-lwt-bgcolor-inactive: var(--toolbox-non-lwt-bgcolor);
	--toolbox-non-lwt-textcolor: light-dark(black, white);
	//TODO: Colour Windows 10 CSDs using these variables, and get proper inactive backgrounds

	//&:not([customthememode="1"]) {
		&[lwtheme] {
			&:not([lwtheme-id*="firefox-compact"], [lwtheme-id*="compact-light"]) {
					&[captionbuttonbackground="true"] {
						--titlebar-buttonbox-background: var(--toolbar-bgcolor, var(--lwt-accent-color));
					}
			}
		}
	//}
	&[lwtheme-id*="firefox-compact-light"][chrtheme="true"] {
		--titlebar-buttonbox-background: var(--chrt-theme-window-control-background, var(--chrt-control-background, var(--chrt-button-background, transparent)));
	}

	// Fixes for various OS quirks
	&[gktitnative="false"] {
		//Linux quirk: Counteract exclusive menubar padding
		@media (-moz-platform: linux) {
			#toolbar-menubar .titlebar-buttonbox-container {
				margin-block-start: calc(var(--titlebar-border-radius) - 3px); // top margin
			}
		}

		//Misc. quirk-workarounds
		.titlebar-buttonbox {
			appearance: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
		}

		.titlebar-button {
			appearance: none !important;
			position: relative; // Required for pseudo button-backgrounds
			padding: 0 !important;
			margin: 0 !important;
			margin-inline-end: 0 !important;

			// Pseudo titlebar button background
			&:before {
				content: "";
				position: absolute;
				left: 0;
				top: 0;
				width: 100%;
				height: 100%;
				background: var(--titlebar-buttonbox-background) !important; // you can blame mac for this one
				z-index: -1;
			}

			.toolbarbutton-icon {
				height: auto !important;
				width: auto !important;

				// Fix for Firefox ~120+
				appearance: none !important;
				background: none !important;
				stroke: none !important;
				border-radius: unset !important;
				padding: unset !important;
			}
		}
	}

	//Theme support
	&[lwtheme] {
		&:not([lwtheme-id*="firefox-compact"], [lwtheme-id*="compact-light"]) { //TODO: change to Geckium's themed check
			//TODO: Rename _systhemes.scss to _themes.scss, and move these two variables into it
			--titlebar-active: var(--lwt-accent-color);
			--titlebar-inactive: var(--titlebar-active);
		}
	}














	--inactive-titlebar-opacity: 1 !important; //TODO: unused?

	--chrt-theme-frame-overlay: 0; //TODO: Change to 'unset'

    &[privatebrowsingmode="temporary"] {
        #fxa-toolbar-menu-button {
            display: none !important;
        }
    }

	//Titlebar styles
	// Windows
	&[gktitstyle="win"] {
		@import "borders/win";
	}
	// Windows 10
	&[gktitstyle="win10"] {
		@import "borders/win10";
	}
	// Mac OS X / macOS

	// Chrome OS


	//Titlebutton styles
	// Windows
	&[gktitbuttons="win"] {
		@import "titlebar/caption-buttons/win";
	}
	// Windows 10
	&[gktitbuttons="win10"] {
		@import "titlebar/caption-buttons/win10";
	}
	// Linux (Alpha)
	&[gktitbuttons="linuxog"] {
		@import "titlebar/caption-buttons/linuxog";
	}
	// Linux
	&[gktitbuttons="linux"] {
		@import "titlebar/caption-buttons/linux";
	}
	// Mac OS X

	// macOS

	// Chrome OS (redirected by JS to linuxog)

	&[sizemode="maximized"],
	&[sizemode="fullscreen"] {
		#private-browsing-indicator-with-label {
			margin-block-start: -3px;
			margin-block-end: -3px;
			margin-inline-start: 0px !important;
			margin-inline-end: 5px !important;
		}
	}
}

//TODO: Also move into windows titlebar style?
#private-browsing-indicator-with-label {
    align-items: end !important;
	margin-block-end: 1px;
    margin-inline-start: 1px !important;
    margin-inline-end: 2px !important;
}

.private-browsing-indicator-icon {
    width: auto !important;
    height: auto !important;
}

[data-l10n-id="private-browsing-indicator-label"] {
    display: none !important;
}

.titlebar-buttonbox-container {
	align-self: start;
}