:root {
	// Make Firefox's Windows 10 CSDs white to be faithful to Windows 10+'s titlebar
	--toolbox-non-lwt-bgcolor: light-dark(white, black);
	--toolbox-non-lwt-bgcolor-inactive: var(--toolbox-non-lwt-bgcolor);
	--toolbox-non-lwt-textcolor: light-dark(black, white);
	//TODO: Colour Windows 10 CSDs using these variables, and get proper inactive backgrounds

	&[gkthemed]:not([gkchrthemed]) {
		&[captionbuttonbackground="true"] {
			--titlebar-buttonbox-background: var(--toolbar-bgcolor, var(--lwt-accent-color));
		}
	}
	&[gkthemed][gkchrthemed] {
		--titlebar-buttonbox-background: var(--chrtheme-theme-window-control-background, var(--chrtheme-control-background, var(--chrtheme-button-background, transparent)));
		--titlebar-foreground: var(--chrtheme-toolbar-button-icon, var(--default-toolbarbutton-icon-fill));
		--titlebar-foreground-inactive: var(--chrtheme-toolbar-button-icon, var(--default-toolbarbutton-icon-fill)); //FIXME: This needs to be tinted
	}

	// Fixes for various OS quirks
	&[gktitnative="true"] {
		//Windows quirks
		@media (-moz-platform: windows) {
			// Top-align the titlebar buttons, so the Win8- AERO cut-out aligns
			.titlebar-buttonbox-container {
				align-self: start;
			}
			//Fix the titlebar in unmaximised Windows Basic
			@media (-moz-windows-compositor: 0) {
				&[sizemode="normal"] #titlebar {
					appearance: none !important; // this leaves behind the background colour
					// TODO: In Windows XP make the #titlebar appear as appearance toolbar?
					&::before {
						content: "";
						position: fixed;
						appearance: -moz-window-titlebar;
						// the following is to account for what I can only assume
						// to be the gaps in borders-gaps.scss.
						width: 102%;
						margin-left: -2px;
					}
				}
			}
			//Windows 10 + Native Controls Patch quirks
			@media (-moz-ev-native-controls-patch) {
				&#main-window { // Prevent dark Firefox from using a background
					background: rgba(0,0,0,.002) !important;
				}
			}
		}
		//Linux quirks
		@media (-moz-platform: linux) {
			// Stop Light and Dark from getting custom Firefox titlebars
			&:not([gkthemed]:not([gkchrthemed])) {
				#navigator-toolbox {
					background-image: unset !important;
					background-repeat: unset !important;
					background-position: unset !important; //browser.css:88, 115
				}
				&:not([is117Plus]) #navigator-toolbox {
					background-color: transparent !important; //browser.css:37, 115
				}
				&[is117Plus] #navigator-toolbox {
					background-color: var(--toolbox-non-lwt-bgcolor) !important;
					color: var(--toolbox-non-lwt-textcolor) !important; //browser-shared.css:205, 128
					&:-moz-window-inactive {
						background-color: var(--toolbox-non-lwt-bgcolor-inactive) !important;
						color: var(--toolbox-non-lwt-textcolor-inactive) !important; //browser-shared.css:192, 128
					}
				}
				&:not([is117Plus]) .titlebar-button {
					list-style-image: unset !important; //browser.css:366, 115
					appearance: auto !important; //browser.css:357, 115
					border-radius: unset !important; //browser.css:357, 115
				}
			}
			// Center the titlebar buttons, because Mozilla can't ig...?
			.titlebar-buttonbox-container {
				align-self: center;
			}
		}
	}
	&[gktitnative="false"] {
		//Windows quirks
		@media (-moz-platform: windows) {
			//Prevent Basic's titlebar texture showing
			@media (-moz-windows-compositor: 0) {
				#titlebar {
					appearance: none !important;
				}
			}
			//Remove margin in Windows Classic
			@media (-moz-windows-classic) {
				#toolbar-menubar {
					margin-top: 0 !important;
				}
			}
			//Windows 10 + Native Controls Patch quirks
			@media (-moz-ev-native-controls-patch) {
				&#main-window {
					background: rgba(0,0,0,.002) !important;
				}
			}
		}

		//Linux quirks
		@media (-moz-platform: linux) {
			/* In Linux, we don't have a surface spanning the entire browser window to draw our borders on.
			- GTK3's CSDs only cover the browser from top to bookmarks area
			- Shadows are out of the CSS's boundaries
			Therefore, to get the desired borders, we need to hijack body. */
			#navigator-toolbox-background {
				appearance: none !important; //FIXME: This causes the corner shadows to disappear
			}
			/* However, likely due to a Firefox bug, Firefox's underlying window surface
			uses the body's background itself, due to Mozilla setting its background
			to 'transparent', unless we use a minimum 0.002 alpha background on the window,
			so we need to override that. */
			&#main-window {
				background: rgba(0,0,0,.002) !important;
			}
			// Counteract exclusive menubar padding
			#toolbar-menubar .titlebar-buttonbox-container {
				margin-block-start: calc(var(--titlebar-border-radius) - 3px); // top margin
			}
		}

		//macOS quirks
		@media (-moz-platform: macos) {
			&[windowtype="navigator:browser"] > body {
				// Corners on the bottom are rounded, as aforementioned, too
				border-radius: var(--titlebar-border-radius);
			}
		}

		//Misc. quirk-workarounds
		.titlebar-buttonbox-container {
			align-self: start; // Positions the buttons correctly
		}

		#navigator-toolbox-background {
			position: relative; // Makes the background PROPERLY disappear
		}

		.titlebar-buttonbox {
			appearance: none !important;
			margin-left: 0 !important;
			margin-right: 0 !important;
		}

		.titlebar-button {
			appearance: none !important;
			position: relative; // Required for pseudo button-backgrounds
			padding: 0 !important;
			margin: 0 !important;
			margin-inline-end: 0 !important;

			// Pseudo titlebar button background
			&:before {
				content: "";
				position: absolute;
				left: 0;
				top: 0;
				width: 100%;
				height: 100%;
				background: var(--titlebar-buttonbox-background) !important; // you can blame mac for this one
				z-index: -1;
			}

			.toolbarbutton-icon {
				height: auto !important;
				width: auto !important;

				// Fix for Firefox ~120+
				appearance: none !important;
				background: none !important;
				stroke: none !important;
				border-radius: unset !important;
				padding: unset !important;
			}
		}
	}

	//Theme support
	&[gkthemed]:not([gkchrthemed]) {
		//TODO: Rename _systhemes.scss to _themes.scss, and move these two variables into it
		--titlebar-active: var(--lwt-accent-color);
		--titlebar-inactive: var(--titlebar-active);
		--titlebar-foreground: var(--lwt-text-color);
		--titlebar-foreground-inactive: var(--lwt-text-color);
	} //TODO: Should variables assignment just be done in JS, to simplify the process? Could do QML style ? ... : ... one-liners even...?














	--inactive-titlebar-opacity: 1 !important; //TODO: unused?

	--chrtheme-theme-frame-overlay: 0; //TODO: Change to 'unset'

    &[privatebrowsingmode="temporary"] {
        #fxa-toolbar-menu-button {
            display: none !important;
        }
    }

	//Titlebar styles
	// Native Titlebar Enabled
	&[gktitstyle="native"] {
		@import "titlebar/borders/native";
	}
	// Windows
	&[gktitstyle="win"] {
		@import "titlebar/borders/win";
	}
	// Windows 10
	&[gktitstyle="win10"] {
		@import "titlebar/borders/win10";
	}
	// Mac OS X / macOS
	&[gktitstyle="macos"] {
		@import "titlebar/borders/macos";
	}
	// Chromium OS
	&[gktitstyle="chromiumos"] {
		@import "titlebar/borders/chromiumos";
	}


	//Titlebutton styles
	// Windows
	&[gktitbuttons="win"] {
		@import "titlebar/buttons/win";
	}
	// Windows 10
	&[gktitbuttons="win10"] {
		@import "titlebar/buttons/win10";
	}
	// Linux (Alpha)
	&[gktitbuttons="linuxog"] {
		@import "titlebar/buttons/linuxog";
	}
	// Linux
	&[gktitbuttons="linux"] {
		@import "titlebar/buttons/linux";
	}
	// Mac OS X
	&[gktitbuttons="macosx"] {
		@import "titlebar/buttons/macosx";
	}
	// macOS
	&[gktitbuttons="macos"] {
		@import "titlebar/buttons/macos";
	}
	// Chromium OS (redirected by JS to linuxog)
}