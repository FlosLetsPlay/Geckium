/* bruni: This is the code for the window frame when Chromium's classic
		  theme is enabled. This code is also used by custom themes. */

& {
	--titlebar-buttonbox-pseudo-background: transparent;

	&#main-window {
		/* bruni: Firefox is weird, if we set the root to be transparent,
				  then it takes body's background. The lowest we can go in
				  alpha is 0.002 for that bug (assuming it's one) to not
				  happen. */
		@media (-moz-ev-native-controls-patch) {
			background: rgba(0,0,0,.002) !important;
		}

		@media not (-moz-platform: windows) {
			background: rgba(0,0,0,.002) !important;
		}
	}

	&[chromemargin="0,0,0,0"] {
		&[tabsintitlebar] {
			#tabbrowser-arrowscrollbox {
				padding-top: 7px !important;
			}
		}

		&[sizemode="maximized"],
		&[sizemode="fullscreen"] {
			&[windowtype="navigator:browser"] > body {
				border: 0 !important;
				border-radius: 0 !important;
				box-shadow: none !important;
			}

			&[tabsintitlebar] {
				#tabbrowser-arrowscrollbox {
					padding-top: 0 !important;
				}
			}
		}

		&[windowtype="navigator:browser"] > body {
			background: var(--titlebar-active);
			box-shadow: inset 1px 1px 0 0 rgba(255, 255, 255, 0.25);
			border-top: 1px solid rgb(89, 89, 89);
			border-left: 1px solid rgb(89, 89, 89);
			border-bottom: 1px solid rgb(68, 68, 68);
			border-right: 1px solid rgb(68, 68, 68);
			border-radius: 5px;
			padding: 1px !important;
			box-sizing: border-box;

			@media (-moz-platform: linux) {
				& {
					border-top-left-radius: 6px !important;
					border-top-right-radius: 6px !important;
					border-bottom-left-radius: 0 !important;
					border-bottom-right-radius: 0 !important;
					padding: 2px !important;
				}
			}

			&:-moz-window-inactive {
				background: var(--titlebar-inactive);
			}
		}

		&[sizemode="maximized"],
		&[sizemode="fullscreen"] {
			&[windowtype="navigator:browser"] > body {
				padding: 0 !important;
			}
		}

		&[sizemode="maximized"] {
			&[windowtype="navigator:browser"] > body {
				@media not (-moz-platform: linux) {
					// padding-top: 7px !important;
				}
			}

			// Fix button position when maximized
			#titlebar {
				@media (-moz-platform: windows) {
					@media not (-moz-platform: windows-win10) {
						padding-block-start: 8px;
					}

					@media (-moz-platform: windows-win10) {
						padding-block-start: 0;

						@media not (-moz-ev-native-controls-patch) {
							padding-block-start: 8px;
						}
					}

					@media (-moz-windows-classic) {
						padding-block-start: 4px !important;
					}
				}
			}
			&[is117Plus] {
				#titlebar {
					@media (-moz-platform: windows) {
						@media (-moz-platform: windows-win10) {
							@media not (-moz-ev-native-controls-patch) {
								padding-block-start: 0;
							}
						}
					}
				}
			}
		}

		&[sizemode="normal"] {
			.titlebar-restore {
				display: none !important;
			}
		}
		
		&[sizemode="maximized"],
		&[sizemode="fullscreen"] {
			.titlebar-max {
				display: none !important;
			}
		}

		@media (-moz-windows-classic) {
			#toolbar-menubar {
				margin: 0 !important;
			}
		}

		// This fixes titlebar in Windows basic and Windows classic.
		#titlebar {
			appearance: unset !important;
		}

		/*.titlebar-buttonbox-container {
			justify-content: end;
			width: calc(var(--titlebar-close-width) + var(--titlebar-max-restore-width) + var(--titlebar-min-width) + (var(--titlebar-buttonbox-gap) * 2));
		}*/

		&[gkbranding="chrome"] {
			.titlebar-buttonbox-container {
				@media (-moz-platform: windows) {
					&::before {
						content: url("chrome://userchrome/content/assets/img/chrome-1/titlebar/windows/google-alternate.png");
						margin-block-start: 2px;
						margin-inline-end: 7px;
					}
				}
			}
		}

		&[sizemode="maximized"],
		&[sizemode="fullscreen"] {
			.titlebar-buttonbox-container {
				&::before {
					content: unset !important;
				}
			}
		}

		.titlebar-buttonbox {
			appearance: unset !important;
			align-items: start !important;
			height: var(--titlebar-button-height);
			-moz-default-appearance: -moz-window-button-box !important;
			background-color: transparent;
			gap: var(--titlebar-buttonbox-gap);
		}

		.titlebar-button {
			padding: 0 !important;
			margin: 0 !important;
			display: flex !important;
			appearance: unset !important;
			border-radius: var(--titlebar-button-border-radius) !important;
			position: relative;
			background-clip: padding-box;
			height: var(--titlebar-button-height);
			box-shadow: var(--titlebar-button-inner-shadow-normal);
			overflow: hidden;
			transition: background-color 100ms linear;

			&::before {
				content: "";
				position: absolute;
				left: 0;
				top: 0;
				width: 100%;
				height: 100%;
				background: var(--titlebar-buttonbox-pseudo-background);
				z-index: -1;
			}

			&:not([disabled]) {
				&:active {
					transition: none;
				}
			}

			.toolbarbutton-icon {
				width: auto !important;
    			height: auto !important;

				// Fix for Firefox ~120+
				appearance: none !important;
				background: none !important;
        		border-radius: unset !important;
			}
		}

		.titlebar-close {
			width: var(--titlebar-close-width);
			list-style-image: var(--titlebar-close-glyph) !important;
			background: var(--titlebar-close-background-normal) !important;

			&:hover {
				background: var(--titlebar-close-background-hot) !important;
			}

			&:active {
				background: var(--titlebar-close-background-active) !important;
			}
		}

		.titlebar-max,
		.titlebar-restore {
			width: var(--titlebar-max-restore-width) !important;
			background: var(--titlebar-max-restore-background-normal) !important;

			&:hover {
				background: var(--titlebar-max-restore-background-hot) !important;
			}

			&:active {
				background: var(--titlebar-max-restore-background-active) !important;
			}
		}

		.titlebar-max {
			list-style-image: var(--titlebar-max-glyph) !important;
		}

		.titlebar-restore {
			list-style-image: var(--titlebar-restore-glyph) !important;
		}

		.titlebar-min {
			width: var(--titlebar-min-width) !important;
			list-style-image: var(--titlebar-min-glyph) !important;
			background: var(--titlebar-min-background-normal) !important;

			&:hover {
				background: var(--titlebar-min-background-hot) !important;
			}

			&:active {
				background: var(--titlebar-min-background-active) !important;
			}
		}

		&[gkforcecaptionbuttonstyle="auto"] {
			@media not ((-moz-platform: linux) or (-moz-platform: macos)) {
				@import "../titlebar/caption-buttons/windows";
			}
			
			@media (-moz-platform: linux) {
				@import "../titlebar/caption-buttons/linux";
			}
	
			@media (-moz-platform: macos) {
				@import "../titlebar/caption-buttons/macos";
			}
		}
		&[gkforcecaptionbuttonstyle="windows"] {
			@import "../titlebar/caption-buttons/windows";
		}
		&[gkforcecaptionbuttonstyle="linux"] {
			@import "../titlebar/caption-buttons/linux";
		}
		&[gkforcecaptionbuttonstyle="macos"] {
			@import "../titlebar/caption-buttons/macos";
		}
	}
}
